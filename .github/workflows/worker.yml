name: worker
on:
  push:
    branches:
    # Limit to the `master` branch
    - master
jobs:
  worker:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Run Wrangler
      env:
        CF_API_TOKEN: ${{secrets.CF_API_TOKEN}}
      run: |
        # Fix NPM EACCESS: https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally
        mkdir ~/.npm-global
        npm config set prefix '~/.npm-global'
        export PATH=~/.npm-global/bin:$PATH
        source ~/.profile
        # Do the Wrangler stuff
        npm install --global wrangler
        wrangler config
        wrangler publish
